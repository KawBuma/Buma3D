# Buma3D

*低レベルグラフィックスAPIを低レベルで**共通化**する低レベルグラフィックスAPIラッパーライブラリ*

## Supported backends

現在ビルドを行うことができるプラットフォームはWindowsです。

|Platform |D3D12    |Vulkan   |Metal    |
|---------|---------|---------|---------|
|Windows  |✔       |✔       |n/a      |
|Linux    |n/a      |         |n/a      |
|Android  |n/a      |         |n/a      |
|macOS    |n/a      |         |         |
|iOS      |n/a      |         |         |

## Features

- COMライクの C++ コード
- 低CPUオーバーヘッド
  - 可能な限り、ネイティブAPIに直接マップされる薄いラッピング
  - コマンドアロケータのメモリを再利用してネイティブAPIへの構造体変換コストを低減
- ユーザー定義アロケータの設定
- ネイティブに忠実なAPI
  - Vulkan、D3D12ベースのオブジェクトネーミング
  - メモリアライメントなどのハードウェアプロパティのクエリ
  - パイプラインバリア
  - レンダーパス、サブパス
  - ディスクリプタ使用法のきめ細かな制御
- 低レベルグラフィックスAPI特有の機能
  - マルチキューによるコマンドの非同期実行
  - コマンドの並列記録
  - コマンドリストの再利用
  - ディスクリプタの並列更新
- リソースへのメモリバインディング
  - エイリアスバインディング (Placed)
  - スパースバインディング (Reserved)
  - 専用(Dedicated)割り当て (Committed)
- 一般的なレンダリングパイプラインのフルサポート
  - VS, HS, DS, GS, PS
  - ストリーム出力(トランスフォームフィードバック)
  - コンピュートシェーダー
- その他の機能
  - ステートの設定 (ブレンド係数、深度境界テスト、サンプル位置)
  - マルチビュー機能 (View instancing / Multiview)
- クエリ機能
  - タイムスタンプクエリ
  - オクルージョンクエリ
  - パイプライン統計
- デバッギング
  - デバッグの有効/無効化
  - GPUベースの検証
  - オブジェクトへの名前付け
  - イベント、マーカーのセット
  - メッセージキュー
  - Buma3Dオブジェクトのリークチェック

## Build

将来のクロスプラットフォーム化のため、CMakeビルドシステムを使用します。  
現在ビルドを行うことができるプラットフォームはWindowsです。

### Requirements

ビルドにはいくつかのSDKとツールを必要とします:

- Git
- CMake 3.16 以上
- Vulkan SDK 最新のバージョン

### Cloning the repository

githubから[Buma3D](https://github.com/KawBuma/Buma3D)リポジトリをクローンします。 サブモジュールを配置するために`--recursive`を指定します:

```bash
git clone --recursive https://github.com/KawBuma/Buma3D.git
```

### Build on Windows

プロジェクトを生成するディレクトリを作成します:

```bash
mkdir build
```

コマンドプロンプト、または`cmake-gui`からプロジェクトを生成します:

```bash
cmake -S . -B build -G "Visual Studio 16 2019" -A x64
```

ネイティブAPIごとに、そのAPI名をサフィックスにもつ`Buma3D_<API>`ターゲットが生成されます。  
プロジェクトを生成したディレクトリから`Buma3D.sln`を開き、ビルドを開始してください。

## Design

### 抽象化による問題点

Buma3Dは低レベルグラフィックスAPIにのみ依存しており、Buma3Dを利用する描画エンジンに求められる設計思想を特定できません。 一定の操作を1つの機能として抽象化すると、利用者が必要とする低レベルグラフィックスAPIの情報や機能を隠蔽する可能性があります。  
Buma3Dは非常に薄いAPIラップを行い、ネイティブAPIのオブジェクトのネーミング、設計を踏襲しています。

### 共通化

このライブラリは低レベルAPIとしての**共通化**を目標としています。 たとえば、CommandAllocatorとCommandListを1つのAPIとしてラップせず、それぞれのインターフェース単位で共通化しています。 オブジェクトを作成する際のフラグはネイティブAPIのフラグと一致し、Buma3Dの利用者が設定できます。 利用者はBuma3D独自の機能の干渉を極力避けながら、ネイティブAPIの性能を引き出す設計を行うことができます。

## Vs. Engine-specific abstraction layer

ゲームエンジンの描画システムは様々なグラフィックスAPIを考慮して実装されます。 多くの場合、そのエンジンに固有の抽象化レイヤー(UenrealEngine4 RHI など)が存在し、独自の設計が行われます。 Buma3Dはそのようなエンジン固有のレイヤーを独立して提供します。 そのため、Buma3Dを抽象化レイヤーに実装すると、抽象化の効果は重複し、追加のオーバーヘッドだけが伴います。

一方、中小規模のプロジェクトには非常に効果的です。抽象化レイヤーを持たない中規模の描画エンジンで複数のグラフィックスAPIを選択できるようにします。
ネイティブAPIへの詳細なアクセスが可能なため、1つのコードで、ドライバーによる潜在的なバグの発見や動作の不一致を検証可能です。

## Licence

*ライセンスの付与を準備しています。*

このプロジェクトは以下のサードパーティを利用します:

- [DirectX-Headers](https://github.com/microsoft/DirectX-Headers) [(MIT License)](https://github.com/microsoft/DirectX-Headers/blob/main/LICENSE)
